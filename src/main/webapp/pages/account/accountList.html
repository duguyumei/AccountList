<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

  <script src="../../scripts/boot.js" type="text/javascript"></script>


</head>

<body>
<style type="text/css">
  html,
  body {
    margin: 0;
    padding: 0;
    border: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
</style>
<div class="mini-toolbar" style="padding:2px;border-bottom:0;">
  <table style="width:100%;">
    <tr>
      <td style="width:100%;">
        <a class="mini-button" iconCls="icon-add" onclick="addAccount()">新增</a>
        <a class="mini-button" iconCls="icon-add" onclick="openExcel()">excel导入</a>
      </td>
      <td style="white-space:nowrap;"><label style="font-family:Verdana;"></label>
        <input id="tradeguid" class="mini-textbox" emptyText="请输入订单编号" />
        <input id="target" class="mini-textbox" emptyText="请输入商家" />
        <input id="goods" class="mini-textbox" emptyText="请输入商品名" />
        <input id="remark" class="mini-textbox" emptyText="请输入备注" />
        <a class="mini-button" iconCls="icon-search" onclick="onSearch()">查询</a>
        <a class="mini-button" iconCls="icon-reload" onclick="onClear()">清空</a>
      </td>
    </tr>
  </table>
</div>
<!--撑满页面-->
<div class="mini-fit">

  <div id="dishlist" class="mini-datagrid" style="width:100%;height:100%;" url="/accountinfo/getAccountinfo" idField="rowguid"
       sizeList="[10,25,50,100,500,1000]" pageSize="15" sortField="real_date" sortOrder="desc" align="center">
    <div property="columns">IAccountinfoService
      <div type="indexcolumn" align="center" headerAlign="center">序</div>
      <div field="tradeguid" width="225" align="center" headerAlign="center">订单编号</div>
      <div field="real_date" width="120" align="center" dateFormat="yyyy-MM-dd hh:ss"
           allowSort="true" headerAlign="center">订单时间</div>
      <div field="money" width="100" align="center" headerAlign="center" allowSort="true" renderer="onMoneyRenderer">金额</div>
      <div field="goods" width="100%" align="center" headerAlign="center">商品名</div>
      <div field="target" width="120" align="center" headerAlign="center">商家</div>
      <div field="type" width="120" align="center" headerAlign="center">消费类别</div>
      <div field="budget" width="60" align="center" headerAlign="center">收/支</div>
      <div field="status" width="120" align="center" headerAlign="center">订单状态</div>
      <div field="remark" width="100" align="center" headerAlign="center">备注</div>
      <div name="action" width="150" headerAlign="center" align="center" renderer="onActionRenderer"
           cellStyle="padding:0;">操作</div>
    </div>
  </div>

</div>

<script type="text/javascript">
  mini.parse();
  var grid = mini.get("dishlist");
  grid.load(null,function (e) {
    // var json = mini.decode(e.text);
    // $(".mini-pager-right").before("<span id='account_sum' style='margin-left: 15%;display: inline-block;font-weight: bolder'>" +
    //         "总计---元，收入"+json.inmoney+"元，支出"+json.outmoney+"元</span>");
  });
  function openExcel() {
    mini.open({                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      url: "pages/account/fileaccount.html",
      title: "导入账单信息", width: 600, height: 400,
      ondestroy: function (action) {
        grid.reload();
      }
    });
  }

  //操作按钮
  function onActionRenderer(e) {
    var s = ' <a style="margin-left:5px;margin-right: 5px;padding: 2px 5px" class="mini-button" onclick="showAccount(\'' + e.record.rowguid + '\')">详情</a>' +
            ' <a style="margin-right: 5px;padding: 2px 5px" class="mini-button" onclick="editAccount(\'' + e.record.rowguid + '\')">编辑</a>' +
            ' <a style="padding: 2px 5px" class="mini-button" onclick="deleteAccount(\'' + e.record.rowguid + '\')">删除</a>';
    return s;
  }
  //新增
  function addAccount() {
    mini.open({
      url: "pages/account/accountAdd.html",
      title: "新增菜品信息", width: 600, height: 400,
      ondestroy: function (action) {
        grid.reload();
      }
    });
  }
  
  function showAccount(e) {
    mini.open({
      url: "pages/account/accountShow.html?rowguid=" + e,
      title: "查看账单信息", width: 600, height: 450,
      loadOnRefresh:true,
      onload:function(){
        var iframe = this.getIFrameEl();
        var data = {
          action : "show",
          id : e
        };
        iframe.contentWindow.SetData(data);
      },
      ondestroy: function (action) {
        // grid.reload();
      }
    });
  }
  
  function editAccount(e){
    mini.open({
      url: "pages/account/accountEdit.html?rowguid=" + e,
      title: "编辑账单信息", width: 600, height: 400,
      loadOnRefresh:true,
      onload:function(){
        var iframe = this.getIFrameEl();
        var data = {
          action : "edit",
          id : e
        };
        iframe.contentWindow.SetData(data);
      },
      ondestroy: function (action) {
        grid.reload();
        // if (action == "ok") {       //如果点击“确定”
        // var iframe = this.getIFrameEl();
        // //获取选中、编辑的结果
        // var data = iframe.contentWindow.grid.getSelected();
        // data = mini.clone(data);    //必须。克隆数据。
        // console.log(data);
        // mini.get("CompanyUserId").setValue(data.UserId);
        // mini.get("CompanyUserId").setText(data.UserName);
        // }
      }
    });
  }
  function deleteAccount(e) {
    //confirm返回Boolean,mini.confirm()返回警告框，必须加回调函数
    mini.confirm("确定删除记录？", "警告", function (action) {
      if (action == "ok") {
        $.ajax({
          url: "/accountinfo/deleteAccount",
          type: 'post',
          data: {
            rowguid: e,
          },
          cache: false,
          success: function (text) {
            mini.alert("删除成功");
            grid.reload();
          },
          error: function (jqXHR, textStatus, errorThrown) {
            alert(jqXHR.responseText);
          }
        });
      }
    })
  }
  //搜索
  function onSearch() {
    var tradeguid = mini.get("tradeguid").getValue();
    var target = mini.get("target").getValue();
    var goods = mini.get("goods").getValue();
    var remark = mini.get("remark").getValue();
    var params = {
      tradeguid: tradeguid,
      target: target,
      goods: goods,
      remark: remark
    };
    grid.load({
      params:mini.encode(params)
    });
  }
  //清空
  function onClear() {
    mini.get("tradeguid").setValue();
    mini.get("target").setValue();
    mini.get("goods").setValue();
    mini.get("remark").setValue();
    grid.load();
  }
  //处理单价
  function onMoneyRenderer(e) {
    var budget = e.record.budget;
    if (budget == '其他') {
      // e.cellStyle = "color:red";
      e.rowStyle  = "color:orange";
    }
    else if(budget == '收入'){
      e.rowStyle  = "color:blue";
    }
    return e.cellHtml;
  }

</script>

</body>

</html>